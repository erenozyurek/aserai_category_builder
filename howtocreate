GENEL AKIÅ DÄ°YAGRAMI
KullanÄ±cÄ± â†’ /dashboard/templates/create (Sayfa)
  â†’ Pazaryeri seÃ§imi (Trendyol, Hepsiburada, N11, Temu)
  â†’ MarketplaceColumn bileÅŸeni her pazaryeri iÃ§in yÃ¼klenir
  â†’ Her kolon kendi API endpoint'ini Ã§aÄŸÄ±rÄ±r
  â†’ Cache katmanÄ± â†’ Client katmanÄ± â†’ DÄ±ÅŸ API'ler

  1. SAYFA: Kategori OluÅŸtur
Dosya: page.tsx

Bu sayfa CreateTemplatePage bileÅŸenidir. 2 aÅŸamadan oluÅŸur:

AÅŸama 1: Pazaryeri SeÃ§imi
KullanÄ±cÄ± hangi pazaryerlerinde kategori oluÅŸturacaÄŸÄ±nÄ± seÃ§er (Trendyol, Hepsiburada, N11, Temu).

AÅŸama 2: Kategori SeÃ§imi
Her seÃ§ili pazaryeri iÃ§in bir MarketplaceColumn bileÅŸeni render edilir. Her kolon kendi API'sinden kategorileri Ã§eker.

Marketplace Config tanÄ±mlarÄ± (page.tsx:34-88):
const MARKETPLACE_CONFIGS: MarketplaceConfig[] = [
  { id: 'trendyol',    name: 'Trendyol',    icon: 'ğŸŸ ', ... },
  { id: 'hepsiburada', name: 'Hepsiburada', icon: 'ğŸŸ¡', ... },
  { id: 'n11',         name: 'N11',         icon: 'ğŸŸ£', ... },
  { id: 'temu',        name: 'Temu',        icon: 'ğŸ”¶', ... },
];

2. BÄ°LEÅEN: MarketplaceColumn (Kategori Ã‡ekme MantÄ±ÄŸÄ±)
Dosya: MarketplaceColumn.tsx

Bu bileÅŸen, her pazaryeri iÃ§in kategori aÄŸacÄ±nÄ± Ã§eker. Kritik fonksiyon fetchCategories:
// MarketplaceColumn.tsx - satÄ±r 120-165
const fetchCategories = useCallback(async () => {
  setLoading(true);
  try {
    let endpoint = '';
    switch (config.id) {
      case 'trendyol':
        endpoint = '/api/v1/trendyol/category-tree';
        break;
      case 'hepsiburada':
        endpoint = '/api/v1/hepsiburada/categories?action=tree';
        break;
      case 'n11':
        endpoint = '/api/v1/n11/categories?action=simpleTree';
        break;
      case 'temu':
        endpoint = '/api/v1/temu/categories?action=tree';
        break;
    }

    const response = await fetch(endpoint);
    const data = await response.json();

    // Normalize: categoryTree / tree / categories
    let tree: CategoryNode[] = [];
    if (data.categoryTree) tree = data.categoryTree;
    else if (data.tree) tree = data.tree;
    else if (data.categories) tree = data.categories;
    else if (Array.isArray(data)) tree = data;

    const normalizedTree = normalizeTree(tree);
    setCategories(normalizedTree);
  } catch (err) { ... }
}, [config.id]);

Her marketplace iÃ§in birer internal Next.js API route Ã§aÄŸrÄ±lÄ±yor.

3. API ROUTE'LAR VE CACHE KATMANLARI
ğŸŸ  TRENDYOL
API Route: route.ts
import { trendyolCache } from '@/lib/integrations/trendyol/cache';

export async function GET() {
  await trendyolCache.prefetchCategories();
  const categoryTree = trendyolCache.getCachedCategoryTree();
  return NextResponse.json({ success: true, categoryTree, count: categoryTree.length });
}
Cache: cache.ts â†’ trendyolClient.getCategories() Ã§aÄŸÄ±rÄ±r

Client: client.ts â†’ Gateway proxy Ã¼zerinden istek atar

Config & API Keys: config.ts

GATEWAY_URL:           https://gate.dizelweb.com.tr/
BASE_URL:              https://apigw.trendyol.com
SELLER_ID:             944254
API_KEY:               D4MHXiH51nAizADyCw5h
API_SECRET:            AyjDEMoVdMMgYVzS4Xi2
AUTH_TOKEN (Base64):   RDRNSFhpSDUxbkFpekFEeUN3NWg6QXlqREVNb1ZkTU1nWVZ6UzRYaTI=
INTEGRATION_REFERENCE: 36f07439-e79d-46a5-8f90-34dd1f00806c
Kategori Endpoint:     /integration/product/product-categories


Ä°stek nasÄ±l atÄ±lÄ±yor:
Gateway proxy kullanÄ±lÄ±yor â†’ https://gate.dizelweb.com.tr/?endpoint=https://apigw.trendyol.com/integration/product/product-categories&method=GET&auth=RDRNSFhpSDUxb...

ğŸŸ¡ HEPSÄ°BURADA
API Route: route.ts
import { hepsiburadaCache } from '@/lib/integrations/hepsiburada/cache';

export async function GET(req: Request) {
  await hepsiburadaCache.prefetchCategories();
  if (action === 'tree') {
    const tree = hepsiburadaCache.getCachedCategoryTree();
    return NextResponse.json({ success: true, tree, count: tree.length });
  }
}

Cache: cache.ts â†’ SayfalÄ± olarak tÃ¼m kategorileri Ã§eker

Client: client.ts â†’ Basic Auth ile istek atar

Config & API Keys: config.ts
BASE_URL (Test):     https://mpop-sit.hepsiburada.com
PRODUCTION_URL:      https://mpop.hepsiburada.com
MERCHANT_ID:         3f95e71f-c39e-4266-9eb4-c154807e87f7
USERNAME:            3f95e71f-c39e-4266-9eb4-c154807e87f7
PASSWORD:            d8rCXfXqWJW2
Auth Format:         Basic base64(USERNAME:PASSWORD)
User-Agent:          aserai_dev
Kategori Endpoint:   /product/api/categories/get-all-categories?page=0&size=1000&leaf=true&available=true

 N11
API Route: route.ts

N11 simpleTree action'Ä± iÃ§in doÄŸrudan CDN'e istek atar (cache bypass):
if (action === 'simpleTree') {
  const response = await fetch('https://api.n11.com/cdn/categories', {
    method: 'GET',
    headers: {
      'Accept': 'application/json',
      'appkey': process.env.N11_APP_KEY || '0b8b3d6e-905b-4f5c-a671-8b00cf9e4916',
      'appsecret': process.env.N11_APP_SECRET || 'WvbrurmwzjKrCVD2',
    },
  });
  const data = await response.json();
  return NextResponse.json({ success: true, tree: data.categories || data });
}

Client: client.ts

Config & API Keys: config.ts

BASE_URL:          https://api.n11.com
CDN_BASE_URL:      https://api.n11.com
APP_KEY:           0dd2dc03-aa31-4063-b711-1bc70ca3b9e6  (config default)
                   0b8b3d6e-905b-4f5c-a671-8b00cf9e4916  (route.ts hardcoded fallback)
APP_SECRET:        mbV91gBst6hMTBJZ                       (config default)
                   WvbrurmwzjKrCVD2                        (route.ts hardcoded fallback)
Auth Header:       appkey + appsecret header'larÄ± (CDN iÃ§in)
                   Basic base64(appKey:appSecret) (REST API iÃ§in)
Store Username:    testtmagazaa
Store Password:    Deneme.12345
INTEGRATOR_NAME:   aserai_dev
Kategori Endpoint: /cdn/categories

Not: N11'de route.ts iÃ§inde hardcoded fallback key'ler ve config.ts'deki key'ler farklÄ±. process.env.N11_APP_KEY set edilmemiÅŸse route.ts kendi fallback'ini kullanÄ±yor.

4. CACHE MEKANÄ°ZMASI (Her 4 Marketplace AynÄ± Pattern)
Her marketplace'in cache'i aynÄ± mantÄ±kla Ã§alÄ±ÅŸÄ±r:

TTL: Kategoriler 1 saat, Ã–zellikler 30 dakika
Singleton pattern: Global instance, sunucu restart'a kadar cache'te kalÄ±r
Loading lock: AynÄ± anda birden fazla istek gelirse sadece 1'i API'ye gider, diÄŸerleri bekler
Flat + Tree: Hem dÃ¼z liste hem aÄŸaÃ§ yapÄ±sÄ± oluÅŸturulur

prefetchCategories() â†’ cache geÃ§erli mi?
  â”œâ”€ EVET â†’ cached data dÃ¶n
  â”œâ”€ HAYIR, loading mi? â†’ loading bitene kadar bekle
  â””â”€ HAYIR â†’ API'den Ã§ek â†’ flatten + buildTree â†’ cache'e yaz â†’ dÃ¶n


  5. TÃœM DOSYA HARÄ°TASI
Katman	Trendyol	Hepsiburada	N11	Temu
Sayfa	create/page.tsx	â†	â†	â†
BileÅŸen	MarketplaceColumn.tsx	â†	â†	â†
API Route	trendyol/category-tree/route.ts	hepsiburada/categories/route.ts	n11/categories/route.ts	temu/categories/route.ts
Cache	trendyol/cache.ts	hepsiburada/cache.ts	n11/cache.ts	temu/cache.ts
Client	trendyol/client.ts	hepsiburada/client.ts	n11/client.ts	temu/client.ts
Config	trendyol/config.ts	hepsiburada/config.ts	n11/config.ts	temu/config.ts


